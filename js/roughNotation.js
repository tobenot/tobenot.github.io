var RoughNotation=function(t){"use strict";const y="http://www.w3.org/2000/svg";class e{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}function k(t,e,s,i,n){return{type:"path",ops:a(t,e,s,i,n)}}function x(e,t,s){var i=(e||[]).length;if(2<i){const k=[];for(let t=0;t<i-1;t++)k.push(...a(e[t][0],e[t][1],e[t+1][0],e[t+1][1],s));return t&&k.push(...a(e[i-1][0],e[i-1][1],e[0][0],e[0][1],s)),{type:"path",ops:k}}return 2===i?k(e[0][0],e[0][1],e[1][0],e[1][1],s):{type:"path",ops:[]}}function M(t,e,s,i,n){return x([[t,e],[t+s,e],[t+s,e+i],[t,e+i]],!0,n)}function S(t,e,s,i,n){return function(t,e,s,i){const[n,r]=l(i.increment,t,e,i.rx,i.ry,1,i.increment*h(.1,h(.4,1,s),s),s);let o=u(n,null,s);if(!s.disableMultiStroke){const[n]=l(i.increment,t,e,i.rx,i.ry,1.5,0,s),r=u(n,null,s);o=o.concat(r)}return{estimatedPoints:r,opset:{type:"path",ops:o}}}(t,e,n,(t=s,e=i,s=n,i=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),i=Math.max(s.curveStepCount,s.curveStepCount/Math.sqrt(200)*i),i=2*Math.PI/i,t=Math.abs(t/2),e=Math.abs(e/2),n=1-s.curveFitting,{increment:i,rx:t+=_(t*n,s),ry:e+=_(e*n,s)})).opset}function v(t){return t.randomizer||(t.randomizer=new e(t.seed||0)),t.randomizer.next()}function h(t,e,s,i=1){return s.roughness*i*(v(s)*(e-t)+t)}function _(t,e,s=1){return h(-t,t,e,s)}function a(t,e,s,i,n,r=!1){var r=r?n.disableMultiStrokeFill:n.disableMultiStroke,o=c(t,e,s,i,n,!0,!1);return r?o:(r=c(t,e,s,i,n,!0,!0),o.concat(r))}function c(t,e,s,i,n,r,o){var h=Math.pow(t-s,2)+Math.pow(e-i,2),a=Math.sqrt(h);let c,u=(c=a<200?1:500<a?.4:-.0016668*a+1.233334,n.maxRandomnessOffset||0);const l=(u=u*u*100>h?a/10:u)/2,f=.2+.2*v(n);var h=n.bowing*n.maxRandomnessOffset*(i-e)/200,a=n.bowing*n.maxRandomnessOffset*(t-s)/200,h=_(h,n,c),a=_(a,n,c),d=[],g=()=>_(l,n,c),p=()=>_(u,n,c);return r&&d.push(o?{op:"move",data:[t+g(),e+g()]}:{op:"move",data:[t+_(u,n,c),e+_(u,n,c)]}),d.push(o?{op:"bcurveTo",data:[h+t+(s-t)*f+g(),a+e+(i-e)*f+g(),h+t+2*(s-t)*f+g(),a+e+2*(i-e)*f+g(),s+g(),i+g()]}:{op:"bcurveTo",data:[h+t+(s-t)*f+p(),a+e+(i-e)*f+p(),h+t+2*(s-t)*f+p(),a+e+2*(i-e)*f+p(),s+p(),i+p()]}),d}function u(e,t,s){var i=e.length,n=[];if(3<i){var r=[],o=1-s.curveTightness;n.push({op:"move",data:[e[1][0],e[1][1]]});for(let t=1;t+2<i;t++){const s=e[t];r[0]=[s[0],s[1]],r[1]=[s[0]+(o*e[t+1][0]-o*e[t-1][0])/6,s[1]+(o*e[t+1][1]-o*e[t-1][1])/6],r[2]=[e[t+1][0]+(o*e[t][0]-o*e[t+2][0])/6,e[t+1][1]+(o*e[t][1]-o*e[t+2][1])/6],r[3]=[e[t+1][0],e[t+1][1]],n.push({op:"bcurveTo",data:[r[1][0],r[1][1],r[2][0],r[2][1],r[3][0],r[3][1]]})}if(t&&2===t.length){const e=s.maxRandomnessOffset;n.push({op:"lineTo",data:[t[0]+_(e,s),t[1]+_(e,s)]})}}else 3===i?(n.push({op:"move",data:[e[1][0],e[1][1]]}),n.push({op:"bcurveTo",data:[e[1][0],e[1][1],e[2][0],e[2][1],e[2][0],e[2][1]]})):2===i&&n.push(...a(e[0][0],e[0][1],e[1][0],e[1][1],s));return n}function l(e,s,i,n,r,o,t,h){var a=[],c=[],u=_(.5,h)-Math.PI/2;c.push([_(o,h)+s+.9*n*Math.cos(u-e),_(o,h)+i+.9*r*Math.sin(u-e)]);for(let t=u;t<2*Math.PI+u-.01;t+=e){const e=[_(o,h)+s+n*Math.cos(t),_(o,h)+i+r*Math.sin(t)];a.push(e),c.push(e)}return c.push([_(o,h)+s+n*Math.cos(u+2*Math.PI+.5*t),_(o,h)+i+r*Math.sin(u+2*Math.PI+.5*t)]),c.push([_(o,h)+s+.98*n*Math.cos(u+t),_(o,h)+i+.98*r*Math.sin(u+t)]),c.push([_(o,h)+s+.9*n*Math.cos(u+.5*t),_(o,h)+i+.9*r*Math.sin(u+.5*t)]),[c,a]}function z(t,e){return{maxRandomnessOffset:2,roughness:"highlight"===t?3:1.5,bowing:1,stroke:"#000",strokeWidth:1.5,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,combineNestedSvgPaths:!1,disableMultiStroke:"double"!==t,disableMultiStrokeFill:!1,seed:e}}class s{constructor(t,e){this._state="unattached",this._resizing=!1,this._seed=Math.floor(Math.random()*2**31),this._lastSizes=[],this._animationDelay=0,this._resizeListener=()=>{this._resizing||(this._resizing=!0,setTimeout(()=>{this._resizing=!1,"showing"===this._state&&this.haveRectsChanged()&&this.show()},400))},this._e=t,this._config=JSON.parse(JSON.stringify(e)),this.attach()}get animate(){return this._config.animate}set animate(t){this._config.animate=t}get animationDuration(){return this._config.animationDuration}set animationDuration(t){this._config.animationDuration=t}get iterations(){return this._config.iterations}set iterations(t){this._config.iterations=t}get color(){return this._config.color}set color(t){this._config.color!==t&&(this._config.color=t,this.refresh())}get strokeWidth(){return this._config.strokeWidth}set strokeWidth(t){this._config.strokeWidth!==t&&(this._config.strokeWidth=t,this.refresh())}get padding(){return this._config.padding}set padding(t){this._config.padding!==t&&(this._config.padding=t,this.refresh())}attach(){var t,e;"unattached"===this._state&&this._e.parentElement&&(window.__rno_kf_s||((e=window.__rno_kf_s=document.createElement("style")).textContent="@keyframes rough-notation-dash { to { stroke-dashoffset: 0; } }",document.head.appendChild(e)),(e=this._svg=document.createElementNS(y,"svg")).setAttribute("class","rough-annotation"),(t=e.style).position="absolute",t.top="0",t.left="0",t.overflow="visible",t.pointerEvents="none",t.width="100px",t.height="100px",t="highlight"===this._config.type,this._e.insertAdjacentElement(t?"beforebegin":"afterend",e),this._state="not-showing",!t||(t=window.getComputedStyle(this._e).position)&&"static"!==t||(this._e.style.position="relative"),this.attachListeners())}detachListeners(){window.removeEventListener("resize",this._resizeListener),this._ro&&this._ro.unobserve(this._e)}attachListeners(){this.detachListeners(),window.addEventListener("resize",this._resizeListener,{passive:!0}),!this._ro&&"ResizeObserver"in window&&(this._ro=new window.ResizeObserver(t=>{for(const e of t)e.contentRect&&this._resizeListener()})),this._ro&&this._ro.observe(this._e)}haveRectsChanged(){if(this._lastSizes.length){var e=this.rects();if(e.length!==this._lastSizes.length)return!0;for(let t=0;t<e.length;t++)if(!this.isSameRect(e[t],this._lastSizes[t]))return!0}return!1}isSameRect(t,e){var s=(t,e)=>Math.round(t)===Math.round(e);return s(t.x,e.x)&&s(t.y,e.y)&&s(t.w,e.w)&&s(t.h,e.h)}isShowing(){return"not-showing"!==this._state}refresh(){this.isShowing()&&!this.pendingRefresh&&(this.pendingRefresh=Promise.resolve().then(()=>{this.isShowing()&&this.show(),delete this.pendingRefresh}))}show(){switch(this._state){case"unattached":break;case"showing":this.hide(),this._svg&&this.render(this._svg,!0);break;case"not-showing":this.attach(),this._svg&&this.render(this._svg,!1)}}hide(){if(this._svg)for(;this._svg.lastChild;)this._svg.removeChild(this._svg.lastChild);this._state="not-showing"}remove(){this._svg&&this._svg.parentElement&&this._svg.parentElement.removeChild(this._svg),this._svg=void 0,this._state="unattached",this.detachListeners()}render(s,t){let i=this._config;t&&((i=JSON.parse(JSON.stringify(this._config))).animate=!1);var n=this.rects();let r=0;n.forEach(t=>r+=t.w);var o=i.animationDuration||800;let h=0;for(let e=0;e<n.length;e++){var a=o*(n[e].w/r);{c=void 0;u=void 0;l=void 0;f=void 0;d=void 0;g=void 0;p=void 0;v=void 0;_=void 0;m=void 0;w=void 0;var c=s;var u=n[e];var l=i;var f=h+this._animationDelay;var d=a;var g=this._seed;const b=[];let t=l.strokeWidth||2;var p=function(t){var e=t.padding;if(e||0===e){if("number"==typeof e)return[e,e,e,e];if(Array.isArray(e)){const t=e;if(t.length)switch(t.length){case 4:return[...t];case 1:return[t[0],t[0],t[0],t[0]];case 2:return[...t,...t];case 3:return[...t,t[1]];default:return[t[0],t[1],t[2],t[3]]}}}return[5,5,5,5]}(l),v=void 0===l.animate||!!l.animate,_=l.iterations||2,m=l.rtl?1:0,w=z("single",g);switch(l.type){case"underline":{const c=u.y+u.h+p[2];for(let t=m;t<_+m;t++)t%2?b.push(k(u.x+u.w,c,u.x,c,w)):b.push(k(u.x,c,u.x+u.w,c,w));break}case"strike-through":{const c=u.y+u.h/2;for(let t=m;t<_+m;t++)t%2?b.push(k(u.x+u.w,c,u.x,c,w)):b.push(k(u.x,c,u.x+u.w,c,w));break}case"box":{const c=u.x-p[3],y=u.y-p[0],k=u.w+(p[1]+p[3]),x=u.h+(p[0]+p[2]);for(let t=0;t<_;t++)b.push(M(c,y,k,x,w));break}case"bracket":{const c=Array.isArray(l.brackets)?l.brackets:l.brackets?[l.brackets]:["right"],y=u.x-2*p[3],k=u.x+u.w+2*p[1],M=u.y-2*p[0],S=u.y+u.h+2*p[2];for(const l of c){let t;switch(l){case"bottom":t=[[y,u.y+u.h],[y,S],[k,S],[k,u.y+u.h]];break;case"top":t=[[y,u.y],[y,M],[k,M],[k,u.y]];break;case"left":t=[[u.x,M],[y,M],[y,S],[u.x,S]];break;case"right":t=[[u.x+u.w,M],[k,M],[k,S],[u.x+u.w,S]]}t&&b.push(x(t,!1,w))}break}case"crossed-off":{const c=u.x,y=u.y,x=c+u.w,M=y+u.h;for(let t=m;t<_+m;t++)t%2?b.push(k(x,M,c,y,w)):b.push(k(c,y,x,M,w));for(let t=m;t<_+m;t++)t%2?b.push(k(c,M,x,y,w)):b.push(k(x,y,c,M,w));break}case"circle":{const c=z("double",g),y=u.w+(p[1]+p[3]),k=u.h+(p[0]+p[2]),x=u.x-p[3]+y/2,M=u.y-p[0]+k/2,l=Math.floor(_/2),f=_-2*l;for(let t=0;t<l;t++)b.push(S(x,M,y,k,c));for(let t=0;t<f;t++)b.push(S(x,M,y,k,w));break}case"highlight":{const c=z("highlight",g),y=(t=.95*u.h,u.y+u.h/2);for(let t=m;t<_+m;t++)t%2?b.push(k(u.x+u.w,y,u.x,y,c)):b.push(k(u.x,y,u.x+u.w,y,c));break}}if(b.length){const u=function(){var e=[];for(const i of b){let t="";for(const n of i.ops){var s=n.data;switch(n.op){case"move":t.trim()&&e.push(t.trim()),t=`M${s[0]} ${s[1]} `;break;case"bcurveTo":t+=`C${s[0]} ${s[1]}, ${s[2]} ${s[3]}, ${s[4]} ${s[5]} `;break;case"lineTo":t+=`L${s[0]} ${s[1]} `}}t.trim()&&e.push(t.trim())}return e}(),k=[],x=[];let s=0;const S=(t,e,s)=>t.setAttribute(e,s);for(const f of u){const u=document.createElementNS(y,"path");if(S(u,"d",f),S(u,"fill","none"),S(u,"stroke",l.color||"currentColor"),S(u,"stroke-width",""+t),v){const c=u.getTotalLength();k.push(c),s+=c}c.appendChild(u),x.push(u)}if(v){let e=0;for(let t=0;t<x.length;t++){const u=x[t],S=k[t],l=s?d*(S/s):0,g=f+e,b=u.style;b.strokeDashoffset=""+S,b.strokeDasharray=""+S,b.animation=`rough-notation-dash ${l}ms ease-out ${g}ms forwards`,e+=l}}}}h+=a}this._lastSizes=n,this._state="showing"}rects(){var e=[];if(this._svg)if(this._config.multiline){var s=this._e.getClientRects();for(let t=0;t<s.length;t++)e.push(this.svgRect(this._svg,s[t]))}else e.push(this.svgRect(this._svg,this._e.getBoundingClientRect()));return e}svgRect(t,e){t=t.getBoundingClientRect();return{x:(e.x||e.left)-(t.x||t.left),y:(e.y||e.top)-(t.y||t.top),w:e.width,h:e.height}}}return t.annotate=function(t,e){return new s(t,e)},t.annotationGroup=function(t){let e=0;for(const s of t){const t=s;t._animationDelay=e,e+=0===t.animationDuration?0:t.animationDuration||800}const s=[...t];return{show(){for(const t of s)t.show()},hide(){for(const t of s)t.hide()}}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});