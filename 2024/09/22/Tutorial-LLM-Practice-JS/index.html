<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"><meta name="description" content="JSå¤§æ¨¡å‹åŸºç¡€å®è·µ(å«Structured Outputs)"><meta name="hexo-theme-A4" content="v1.8.9"><link rel="alternate icon" type="image/webp" href="/img/favicon.webp"><title>ä½œå®¶ä¹‹å±‹</title><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/highlight/style1.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/a11y-dark.min.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/reset.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/markdown.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/fonts.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/waline.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/ui.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/style.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/returnToTop.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/unicons.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/toc.css"><link rel="stylesheet" href="/css/returnToLastPage.css"><link rel="stylesheet" href="/css/lightgallery-bundle.min.css"><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="ä½œå®¶ä¹‹å±‹" type="application/atom+xml">
</head><body><script src="/js/darkmode-js.min.js"></script><script>const options={bottom:"40px",right:"unset",left:"42px",time:"0.3s",mixColor:"#fff",backgroundColor:" #e4e4e4 ",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"ğŸŒ“",autoMatchOsTheme:!0},darkmode=new Darkmode(options);darkmode.showWidget()</script><div class="left-toc-container"><nav id="toc" class="bs-docs-sidebar"></nav></div><div class="paper"><div class="shadow-drop-2-bottom paper-main"><div class="header"><div class="header-container"><style>.header-img{width:56px;height:auto;object-fit:cover;transition:transform .3s ease-in-out;border-radius:0}</style><img alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp"><div class="header-content"><a class="logo" href="/">ä½œå®¶ä¹‹å±‹</a> <span class="description"></span></div></div><ul class="nav"><li><a href="/">ğŸŒŸæ‰‰é¡µ</a></li><li><a href="/list/">ğŸ“æ‰‹ç¨¿</a></li><li><a href="/about/">ğŸ¦‹ä½œè€…</a></li><li><a href="/sleep/">ğŸ˜´ç¡çœ </a></li></ul></div><div class="post-main"><div class="post-main-title" style="text-align:center">JSå¤§æ¨¡å‹åŸºç¡€å®è·µ(å«Structured Outputs)</div><div class="post-head-meta-center"><span>æœ€è¿‘æ›´æ–°ï¼š2024-09-23</span> &nbsp; | &nbsp; <span>å­—æ•°æ€»è®¡ï¼š3.4k</span> &nbsp; | &nbsp; <span>é˜…è¯»ä¼°æ—¶ï¼š17åˆ†é’Ÿ</span> &nbsp; | &nbsp; <span id="busuanzi_container_page_pv">é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡</span></div><div class="post-md"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#JS%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5-%E5%90%ABStructured-Outputs"><span class="post-toc-text">JSå¤§æ¨¡å‹åŸºç¡€å®è·µ(å«Structured Outputs)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-%E5%BC%95%E8%A8%80"><span class="post-toc-text">1. å¼•è¨€</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="post-toc-text">2. ç¯å¢ƒå‡†å¤‡</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-%E5%A6%82%E6%9E%9C%E4%BD%A0%E8%BF%98%E6%B2%A1%E6%9C%89%E5%A4%A7%E6%A8%A1%E5%9E%8BAPI"><span class="post-toc-text">3. å¦‚æœä½ è¿˜æ²¡æœ‰å¤§æ¨¡å‹API</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-%E4%BB%8B%E7%BB%8D%E4%B8%8E%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">4. ä»‹ç»ä¸ç¤ºä¾‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BC%A0%E7%BB%9F"><span class="post-toc-text">ä¼ ç»Ÿ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%B5%81%E5%BC%8F"><span class="post-toc-text">æµå¼</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#json"><span class="post-toc-text">json</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA"><span class="post-toc-text">ç»“æ„åŒ–è¾“å‡º</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-%E6%80%BB%E7%BB%93"><span class="post-toc-text">5. æ€»ç»“</span></a></li></ol></li></ol><link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css"><div class=".article-gallery"><h1 id="JSå¤§æ¨¡å‹åŸºç¡€å®è·µ-å«Structured-Outputs"><a href="#JSå¤§æ¨¡å‹åŸºç¡€å®è·µ-å«Structured-Outputs" class="headerlink" title="JSå¤§æ¨¡å‹åŸºç¡€å®è·µ(å«Structured Outputs)"></a>JSå¤§æ¨¡å‹åŸºç¡€å®è·µ(å«Structured Outputs)</h1><h2 id="1-å¼•è¨€"><a href="#1-å¼•è¨€" class="headerlink" title="1. å¼•è¨€"></a>1. å¼•è¨€</h2><p>æ˜¨å¤©åœ¨åš<a target="_blank" rel="noopener" href="https://tobenot.top/Beyond-Books/">Beyond Books ä¸æ­¢äºçº¸ä¸Šçš„æ•…äº‹</a>çš„å¤šAgentã€æµå¼è¿”å›ã€<a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/structured-outputs/introduction">Structured Outputsï¼ˆç»“æ„åŒ–è¾“å‡ºï¼‰</a>çš„æ—¶å€™ï¼ˆç°åœ¨è¿˜åœ¨åˆ†æ”¯å¼€å‘ï¼Œæ²¡æä¸»å¹²ï¼‰ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†å¥½ä¹…ã€‚<br>æ‰€ä»¥åœ¨æ­¤ç•™ä¸‹ä¸€äº›å¾ˆæ ‡å‡†çš„JSçš„GPTè°ƒç”¨ä»£ç ã€‚<br>ä¼ ç»Ÿçš„ã€æµå¼ã€jsonã€ç»“æ„åŒ–è¾“å‡ºéƒ½æœ‰ã€‚</p><h2 id="2-ç¯å¢ƒå‡†å¤‡"><a href="#2-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2. ç¯å¢ƒå‡†å¤‡"></a>2. ç¯å¢ƒå‡†å¤‡</h2><ul><li>çº¯htmlï¼Œæœ‰ä¸ªæµè§ˆå™¨å°±è¡Œã€‚æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ”¹åç¼€htmlï¼Œå¾€é‡Œé¢å¡ç¤ºä¾‹ä»£ç ï¼Œå¡«å…¥API Keyå’Œåœ°å€ä¹‹ååŒå‡»htmlå°±èƒ½ç”¨ã€‚</li><li>åªè¦æ‰”ç»™AIï¼Œå°±å¯ä»¥æ–¹ä¾¿åœ°å†™è¿›å…¶ä»–é¡¹ç›®é‡Œï¼Œæ¯”å¦‚æˆ‘çš„<a target="_blank" rel="noopener" href="https://tobenot.top/Beyond-Books/">Beyond Books ä¸æ­¢äºçº¸ä¸Šçš„æ•…äº‹</a></li></ul><h2 id="3-å¦‚æœä½ è¿˜æ²¡æœ‰å¤§æ¨¡å‹API"><a href="#3-å¦‚æœä½ è¿˜æ²¡æœ‰å¤§æ¨¡å‹API" class="headerlink" title="3. å¦‚æœä½ è¿˜æ²¡æœ‰å¤§æ¨¡å‹API"></a>3. å¦‚æœä½ è¿˜æ²¡æœ‰å¤§æ¨¡å‹API</h2><p>è¿™ç¯‡ç»™ä½ å‡†å¤‡äº†è¶…æ–°æ‰‹çš„æ•™ç¨‹</p><ul><li>é€‰æ‹©åˆé€‚çš„LLMæœåŠ¡æä¾›å•†<ul><li>å®˜æ–¹<ul><li>æ¯”è¾ƒéº»çƒ¦</li></ul></li><li>ç¬¬ä¸‰æ–¹ <a target="_blank" rel="noopener" href="https://deepbricks.ai/">https://deepbricks.ai/</a><ul><li>æ¯”è¾ƒä¾¿å®œï¼Œä½†æ¯”è¾ƒæ…¢</li></ul></li></ul></li><li>æ‹¿åˆ°API keyså°±å¯ä»¥ç©äº†</li><li>ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒæŠŠYOUR_API_KEYæ›¿æ¢ä¸ºä½ çš„API_KEYï¼ŒæŠŠYOUR_API_URLæ›¿æ¢ä¸ºä½ çš„API_URL<br>æœ‰å•¥å‘ï¼šæ¯”å¦‚è¿™å®¶ <a target="_blank" rel="noopener" href="https://www.gptapi.us/register?aff=qrbV">gptapi</a> CORSæ²¡é…ç½®å¥½ï¼Œæœ¬åœ°ä»¥åŠä¸€äº›è‡ªéƒ¨ç½²çš„ç¯å¢ƒAPIè¿æ¥ä¸åˆ°å®ƒ<br>è€Œä¸”å®ƒè¿˜ä¸æ”¯æŒæµå¼</li></ul><p>æ³¨ï¼šå®˜æ–¹APIæ–‡æ¡£ <a target="_blank" rel="noopener" href="https://platform.openai.com/docs/api-reference/chat/create">https://platform.openai.com/docs/api-reference/chat/create</a></p><h2 id="4-ä»‹ç»ä¸ç¤ºä¾‹"><a href="#4-ä»‹ç»ä¸ç¤ºä¾‹" class="headerlink" title="4. ä»‹ç»ä¸ç¤ºä¾‹"></a>4. ä»‹ç»ä¸ç¤ºä¾‹</h2><h3 id="ä¼ ç»Ÿ"><a href="#ä¼ ç»Ÿ" class="headerlink" title="ä¼ ç»Ÿ"></a>ä¼ ç»Ÿ</h3><p>å°±æ˜¯ä½ æ¥æˆ‘å¾€çš„æ•´å—å›å¤ã€‚<br>ç”¨ä¹ æƒ¯ç½‘é¡µç«¯çš„æœ‹å‹ä»¬æ³¨æ„äº†ï¼ŒAPIåŸºæœ¬éƒ½æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸ä¼šç»´æŠ¤ä¼šè¯å†å²ï¼Œè¿™å†å²ä»æ¥éƒ½æ˜¯è‡ªå·±å­˜çš„ã€‚<br>ç½‘é¡µç«¯åªæ˜¯å¸®å¿™å­˜è€Œå·²ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>OpenAI èŠå¤©<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123; <span class="attribute">font-family</span>: Arial, sans-serif; <span class="attribute">max-width</span>: <span class="number">800px</span>; <span class="attribute">margin</span>: <span class="number">0</span> auto; <span class="attribute">padding</span>: <span class="number">20px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#chat</span> &#123; <span class="attribute">height</span>: <span class="number">400px</span>; <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>; <span class="attribute">overflow-y</span>: scroll; <span class="attribute">padding</span>: <span class="number">10px</span>; <span class="attribute">margin-bottom</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#userInput</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">padding</span>: <span class="number">5px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#sendButton</span> &#123; <span class="attribute">margin-top</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>OpenAI èŠå¤©<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userInput&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¾“å…¥æ‚¨çš„æ¶ˆæ¯...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;sendButton&quot;</span>&gt;</span>å‘é€<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> chatDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chat&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> userInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> sendButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sendButton&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è¯·åœ¨è¿™é‡Œæ›¿æ¢ä¸ºæ‚¨çš„ OpenAI API å¯†é’¥</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">API_KEY</span> = <span class="variable constant_">YOUR_API_KEY</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">API_URL</span> = <span class="variable constant_">YOUR_API_URL</span> + <span class="string">&quot;/v1/chat/completions&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">MODEL</span> = <span class="string">&#x27;gpt-4o-mini&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        sendButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, sendMessage);</span></span><br><span class="line"><span class="language-javascript">        userInput.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keypress&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;Enter&#x27;</span>) <span class="title function_">sendMessage</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">class</span> <span class="title class_">AIService</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">callLargeLanguageModel</span>(<span class="params">prompt</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] å¼€å§‹è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œæç¤ºè¯: <span class="subst">$&#123;prompt&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] API_URL: <span class="subst">$&#123;API_URL&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] MODEL: <span class="subst">$&#123;MODEL&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> requestBody = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; </span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">model</span>: <span class="variable constant_">MODEL</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">messages</span>: [&#123; <span class="attr">role</span>: <span class="string">&quot;user&quot;</span>, <span class="attr">content</span>: prompt &#125;],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">max_tokens</span>: <span class="number">1000</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] è¯·æ±‚ä½“: <span class="subst">$&#123;requestBody&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] å‘é€APIè¯·æ±‚...`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_URL</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;API_KEY&#125;</span>`</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">body</span>: requestBody,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] æ”¶åˆ°APIå“åº”ï¼ŒçŠ¶æ€ç : <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[ERROR] APIè¯·æ±‚å¤±è´¥: <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`API è¯·æ±‚å¤±è´¥: <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] APIå“åº”æ•°æ®: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> content = data.<span class="property">choices</span>[<span class="number">0</span>].<span class="property">message</span>.<span class="property">content</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] æ¨¡å‹è¿”å›å†…å®¹é•¿åº¦: <span class="subst">$&#123;content.length&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> content;</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[ERROR] è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">$&#123;error.message&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">throw</span> error;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> message = userInput.<span class="property">value</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (message) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">appendMessage</span>(<span class="string">&#x27;ç”¨æˆ·: &#x27;</span> + message);</span></span><br><span class="line"><span class="language-javascript">                userInput.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title class_">AIService</span>.<span class="title function_">callLargeLanguageModel</span>(message);</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;åŠ©æ‰‹: &#x27;</span> + response);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;é”™è¯¯:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;åŠ©æ‰‹: æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ã€‚&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">appendMessage</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> messageDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            messageDiv.<span class="property">textContent</span> = message;</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="title function_">appendChild</span>(messageDiv);</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="property">scrollTop</span> = chatDiv.<span class="property">scrollHeight</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æµå¼"><a href="#æµå¼" class="headerlink" title="æµå¼"></a>æµå¼</h3><p>æ¯”è¾ƒä¸æ»‘ï¼Œå¯ä»¥åœ¨å“åº”çš„ä¸€å¼€å§‹å°±å¼€å§‹æ˜¾ç¤ºã€‚<br>é—®é¢˜å°±æ˜¯ä¸å¤ªèƒ½jsonæ ¼å¼åŒ–è§£æï¼Œé€‚åˆåšæ€ç»´é“¾çš„æœ€åä¸€ä¸ªæ˜¾ç¤ºç«¯ã€‚<br>å°±æ˜¯åˆ°æœ€åä¸€æ­¥çš„æ—¶å€™ä¸ç”¨jsonæ ¼å¼è§£æäº†ï¼Œå°±è®©GPTæµå¼è¿”å›ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>OpenAI æµå¼å›å¤èŠå¤©<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123; <span class="attribute">font-family</span>: Arial, sans-serif; <span class="attribute">max-width</span>: <span class="number">800px</span>; <span class="attribute">margin</span>: <span class="number">0</span> auto; <span class="attribute">padding</span>: <span class="number">20px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#chat</span> &#123; <span class="attribute">height</span>: <span class="number">400px</span>; <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>; <span class="attribute">overflow-y</span>: scroll; <span class="attribute">padding</span>: <span class="number">10px</span>; <span class="attribute">margin-bottom</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#userInput</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">padding</span>: <span class="number">5px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#sendButton</span> &#123; <span class="attribute">margin-top</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>OpenAI æµå¼å›å¤èŠå¤©<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userInput&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¾“å…¥æ‚¨çš„æ¶ˆæ¯...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;sendButton&quot;</span>&gt;</span>å‘é€<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> chatDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chat&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> userInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> sendButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sendButton&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è¯·åœ¨è¿™é‡Œæ›¿æ¢ä¸ºæ‚¨çš„ OpenAI API å¯†é’¥</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">OPENAI_API_KEY</span> = <span class="variable constant_">YOUR_API_KEY</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        sendButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, sendMessage);</span></span><br><span class="line"><span class="language-javascript">        userInput.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keypress&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;Enter&#x27;</span>) <span class="title function_">sendMessage</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> message = userInput.<span class="property">value</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (message) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">appendMessage</span>(<span class="string">&#x27;ç”¨æˆ·: &#x27;</span> + message);</span></span><br><span class="line"><span class="language-javascript">                userInput.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">YOUR_API_URL</span> + <span class="string">&quot;/v1/chat/completions&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;OPENAI_API_KEY&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">model</span>: <span class="string">&#x27;gpt-3.5-turbo&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">messages</span>: [&#123; <span class="attr">role</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">content</span>: message &#125;],</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">stream</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;)</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> reader = response.<span class="property">body</span>.<span class="title function_">getReader</span>();</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> decoder = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> buffer = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> assistantResponse = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">const</span> &#123; done, value &#125; = <span class="keyword">await</span> reader.<span class="title function_">read</span>();</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (done) <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        buffer += decoder.<span class="title function_">decode</span>(value, &#123;<span class="attr">stream</span>: <span class="literal">true</span>&#125;);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">const</span> lines = buffer.<span class="title function_">split</span>(<span class="string">&#x27;\n&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                        </span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.<span class="property">length</span> - <span class="number">1</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">const</span> line = lines[i];</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">if</span> (line.<span class="title function_">startsWith</span>(<span class="string">&#x27;data: &#x27;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="keyword">const</span> jsonStr = line.<span class="title function_">slice</span>(<span class="number">6</span>);</span></span><br><span class="line"><span class="language-javascript">                                <span class="keyword">if</span> (jsonStr === <span class="string">&#x27;[DONE]&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                                <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonStr);</span></span><br><span class="line"><span class="language-javascript">                                    <span class="keyword">if</span> (data.<span class="property">choices</span> &amp;&amp; data.<span class="property">choices</span>[<span class="number">0</span>].<span class="property">delta</span>.<span class="property">content</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                                        assistantResponse += data.<span class="property">choices</span>[<span class="number">0</span>].<span class="property">delta</span>.<span class="property">content</span>;</span></span><br><span class="line"><span class="language-javascript">                                        <span class="title function_">updateAssistantMessage</span>(assistantResponse);</span></span><br><span class="line"><span class="language-javascript">                                    &#125;</span></span><br><span class="line"><span class="language-javascript">                                &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;JSONè§£æé”™è¯¯:&#x27;</span>, e);</span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                        buffer = lines[lines.<span class="property">length</span> - <span class="number">1</span>];</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;é”™è¯¯:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;åŠ©æ‰‹: æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ã€‚&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">appendMessage</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> messageDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            messageDiv.<span class="property">textContent</span> = message;</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="title function_">appendChild</span>(messageDiv);</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="property">scrollTop</span> = chatDiv.<span class="property">scrollHeight</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">updateAssistantMessage</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> lastMessage = chatDiv.<span class="property">lastElementChild</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (lastMessage &amp;&amp; lastMessage.<span class="property">textContent</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;åŠ©æ‰‹: &#x27;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">                lastMessage.<span class="property">textContent</span> = <span class="string">&#x27;åŠ©æ‰‹: &#x27;</span> + message;</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">appendMessage</span>(<span class="string">&#x27;åŠ©æ‰‹: &#x27;</span> + message);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="property">scrollTop</span> = chatDiv.<span class="property">scrollHeight</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><p>å¤è€çš„jsonæ ¼å¼åŒ–å›å¤ï¼Œé—®é¢˜æ˜¯æœ‰æ—¶å€™ä¸å¤ªéµå¾ªï¼Œå¯èƒ½ä¼šæ¼å­—æ®µï¼Œæˆ–è€…å­—æ®µé¡ºåºä¹±äº†ã€‚<br>ç‰¹åˆ«æ˜¯å¤šè½®å¯¹è¯çš„æ—¶å€™ï¼ŒGPTå¾ˆå®¹æ˜“è¢«å¯¹è¯å†å²å¸¦è·‘ï¼Œå¯¹äºå‹ç¼©çš„å¯¹è¯å†å²å°±æ›´æ˜¯å¦‚æ­¤äº†ã€‚<br>ç°åœ¨æœ‰äº†ç»“æ„åŒ–è¾“å‡ºï¼Œä¸€èˆ¬éƒ½ä¸ç”¨è¿™ä¸ªjsonæ¨¡å¼äº†ã€‚<br>æ›´å¤è€çš„æ—¶å€™æ²¡æœ‰response_format: { type: â€œjson_objectâ€ }ï¼Œå®ƒç”šè‡³è¿jsonæ ¼å¼éƒ½ä¸å¤ªèƒ½æ­£ç¡®äº†ï¼Œè¿˜å¾—ä¿®å¤ï¼ˆæ¯”å¦‚å†·ä¸é˜²èµ·æ‰‹ä¸‰ä¸ªåå¼•å·ï¼‰ã€‚<br>ç°åœ¨å¥½åƒsonneté‚£äº›æ¨¡å‹æ”¯æŒjsonå¾ˆéº»çƒ¦ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ä¸€ä¸ªæ²¡æœ‰jsonæ¨¡å¼çš„æ¨¡å‹ï¼Œå¯ä»¥åœ¨æ€ç»´é“¾åé¢æ¥ä¸Š4o-miniçš„ç»“æ„åŒ–è¾“å‡ºã€‚</p><p>è¿™ç¤ºä¾‹é‡Œæ˜¯è§£æå‡ºäº†displayï¼Œæ‰€ä»¥çœ‹ç€è¿˜è·Ÿä¼ ç»Ÿçš„ä¸€æ ·ï¼Œä½ å¯ä»¥é—®aiæ€ä¹ˆåŠ å­—æ®µï¼Œæ¯”å¦‚åŠ ä¸ªå¥½æ„Ÿåº¦å˜åŒ–ä»€ä¹ˆçš„å°±èƒ½åšè™šæ‹Ÿæ‹äººäº†ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>OpenAI JSONæ ¼å¼å›å¤èŠå¤©<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123; <span class="attribute">font-family</span>: Arial, sans-serif; <span class="attribute">max-width</span>: <span class="number">800px</span>; <span class="attribute">margin</span>: <span class="number">0</span> auto; <span class="attribute">padding</span>: <span class="number">20px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#chat</span> &#123; <span class="attribute">height</span>: <span class="number">400px</span>; <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>; <span class="attribute">overflow-y</span>: scroll; <span class="attribute">padding</span>: <span class="number">10px</span>; <span class="attribute">margin-bottom</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#userInput</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">padding</span>: <span class="number">5px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#sendButton</span> &#123; <span class="attribute">margin-top</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>OpenAI JSONæ ¼å¼å›å¤èŠå¤©<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userInput&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¾“å…¥æ‚¨çš„æ¶ˆæ¯...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;sendButton&quot;</span>&gt;</span>å‘é€<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> chatDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chat&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> userInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> sendButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sendButton&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">API_KEY</span> = <span class="variable constant_">YOUR_API_KEY</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">API_URL</span> = <span class="variable constant_">YOUR_API_URL</span> + <span class="string">&quot;/v1/chat/completions&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">MODEL</span> = <span class="string">&#x27;gpt-4o-mini&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">SYSTEM_PROMPT</span> = <span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹ã€‚è¯·ä»¥JSONæ ¼å¼å›å¤ï¼ŒåŒ…å«&#x27;display&#x27;å­—æ®µç”¨äºæ˜¾ç¤ºç»™ç”¨æˆ·çš„å†…å®¹ã€‚&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        sendButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, sendMessage);</span></span><br><span class="line"><span class="language-javascript">        userInput.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keypress&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;Enter&#x27;</span>) <span class="title function_">sendMessage</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">class</span> <span class="title class_">AIService</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">callLargeLanguageModel</span>(<span class="params">userMessage</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] å¼€å§‹è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œç”¨æˆ·æ¶ˆæ¯: <span class="subst">$&#123;userMessage&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] API_URL: <span class="subst">$&#123;API_URL&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] MODEL: <span class="subst">$&#123;MODEL&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> requestBody = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; </span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">model</span>: <span class="variable constant_">MODEL</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">messages</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">role</span>: <span class="string">&quot;system&quot;</span>, <span class="attr">content</span>: <span class="variable constant_">SYSTEM_PROMPT</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">role</span>: <span class="string">&quot;user&quot;</span>, <span class="attr">content</span>: userMessage &#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">max_tokens</span>: <span class="number">1000</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">response_format</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;json_object&quot;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] è¯·æ±‚ä½“: <span class="subst">$&#123;requestBody&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] å‘é€APIè¯·æ±‚...`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_URL</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;API_KEY&#125;</span>`</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">body</span>: requestBody,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] æ”¶åˆ°APIå“åº”ï¼ŒçŠ¶æ€ç : <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[ERROR] APIè¯·æ±‚å¤±è´¥: <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`API è¯·æ±‚å¤±è´¥: <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] APIå“åº”æ•°æ®: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> content = data.<span class="property">choices</span>[<span class="number">0</span>].<span class="property">message</span>.<span class="property">content</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] æ¨¡å‹è¿”å›å†…å®¹é•¿åº¦: <span class="subst">$&#123;content.length&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(content);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[ERROR] è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">$&#123;error.message&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">throw</span> error;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> message = userInput.<span class="property">value</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (message) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">appendMessage</span>(<span class="string">&#x27;ç”¨æˆ·: &#x27;</span> + message);</span></span><br><span class="line"><span class="language-javascript">                userInput.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title class_">AIService</span>.<span class="title function_">callLargeLanguageModel</span>(message);</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;åŠ©æ‰‹: &#x27;</span> + response.<span class="property">display</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;é”™è¯¯:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;åŠ©æ‰‹: æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ã€‚&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">appendMessage</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> messageDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            messageDiv.<span class="property">textContent</span> = message;</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="title function_">appendChild</span>(messageDiv);</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="property">scrollTop</span> = chatDiv.<span class="property">scrollHeight</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ç»“æ„åŒ–è¾“å‡º"><a href="#ç»“æ„åŒ–è¾“å‡º" class="headerlink" title="ç»“æ„åŒ–è¾“å‡º"></a>ç»“æ„åŒ–è¾“å‡º</h3><p>ç»“æ„åŒ–è¾“å‡ºèƒ½ä¿è¯è¾“å‡ºæ˜¯jsonæ ¼å¼ï¼Œå®Œå…¨ç¬¦åˆä½ å®šä¹‰çš„schemaçš„jsonæ ¼å¼ã€‚<br>è¾“å‡ºçš„é¡ºåºä¹Ÿæ˜¯ç¡®å®šçš„æŒ‰ç…§ä½ keyç»™çš„é¡ºåºã€‚</p><p>Open AIçš„ä¼Ÿå¤§å‘æ˜ã€‚<a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/structured-outputs/introduction">æ–‡æ¡£é“¾æ¥</a>ã€‚<br>è¿™ä¸ªåªæœ‰4oå’Œ4o-minièƒ½ç”¨ã€‚4tubroé‚£äº›è¿˜æ˜¯åªèƒ½ç”¨jsonæ¨¡å¼ã€‚<br>o1ä¸æ”¯æŒï¼Œo1å®ƒæ˜¯ä¸ªAgentï¼Œè¿jsonæ¨¡å¼éƒ½ä¸æ”¯æŒã€‚</p><p>æœ‰ä¸ªå‘ï¼Œdescriptionä¸ä¼šå½±å“è¾“å‡ºï¼Œçº¯çº¯æ˜¯ç»™ä½ çœ‹çš„æ³¨é‡Š<br>å·²ç»è¯•è¿‡äº†ï¼Œä½ å¯ä»¥è¯•è¯•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">TEST_SCHEMA</span> = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">    <span class="attr">properties</span>: &#123;</span><br><span class="line">        <span class="attr">test</span>: &#123; </span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="attr">description</span>: <span class="string">&quot;åœ¨è¿™ä¸ªå­—æ®µï¼Œä½ å¿…é¡»è¾“å‡ºâ€œåœ¨æµ‹è¯•å“¦â€ã€‚&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">required</span>: [<span class="string">&quot;test&quot;</span>],</span><br><span class="line">    <span class="attr">additionalProperties</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹å®ƒçå›å¤ã€‚</p><p>ä¸‹é¢å…¶å®æ˜¯å®˜æ–¹ç¤ºä¾‹çš„JavaScriptç‰ˆã€‚å¯ä»¥é—®AIæ”¹æˆåˆ«çš„ï¼Œæˆ–è€…æ‹¿ç€è¿™ä¸ªå»æ”¹é€ å¤è€çš„jsonæ¨¡å¼ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>OpenAI ç»“æ„åŒ–è¾“å‡ºèŠå¤©<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123; <span class="attribute">font-family</span>: Arial, sans-serif; <span class="attribute">max-width</span>: <span class="number">800px</span>; <span class="attribute">margin</span>: <span class="number">0</span> auto; <span class="attribute">padding</span>: <span class="number">20px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#chat</span> &#123; <span class="attribute">height</span>: <span class="number">400px</span>; <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>; <span class="attribute">overflow-y</span>: scroll; <span class="attribute">padding</span>: <span class="number">10px</span>; <span class="attribute">margin-bottom</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#userInput</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">padding</span>: <span class="number">5px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#sendButton</span> &#123; <span class="attribute">margin-top</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>OpenAI ç»“æ„åŒ–è¾“å‡ºèŠå¤©<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userInput&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¾“å…¥æ‚¨çš„æ¶ˆæ¯...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;sendButton&quot;</span>&gt;</span>å‘é€<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> chatDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chat&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> userInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> sendButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sendButton&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">API_KEY</span> = <span class="variable constant_">YOUR_API_KEY</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">API_URL</span> = <span class="variable constant_">YOUR_API_URL</span> + <span class="string">&quot;/v1/chat/completions&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">MODEL</span> = <span class="string">&#x27;gpt-4o-mini&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">SYSTEM_PROMPT</span> = <span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„æ•°å­¦è¾…å¯¼å‘˜ã€‚è¯·é€æ­¥å¼•å¯¼ç”¨æˆ·è§£å†³é—®é¢˜ã€‚&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="variable constant_">OUTPUT_SCHEMA</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&quot;object&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">properties</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">steps</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&quot;array&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">items</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&quot;object&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">properties</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">explanation</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">output</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">                        &#125;,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">required</span>: [<span class="string">&quot;explanation&quot;</span>, <span class="string">&quot;output&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">additionalProperties</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">final_answer</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">required</span>: [<span class="string">&quot;steps&quot;</span>, <span class="string">&quot;final_answer&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">additionalProperties</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        sendButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, sendMessage);</span></span><br><span class="line"><span class="language-javascript">        userInput.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keypress&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;Enter&#x27;</span>) <span class="title function_">sendMessage</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">class</span> <span class="title class_">AIService</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">callLargeLanguageModel</span>(<span class="params">userMessage</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] å¼€å§‹è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œç”¨æˆ·æ¶ˆæ¯: <span class="subst">$&#123;userMessage&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] API_URL: <span class="subst">$&#123;API_URL&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] MODEL: <span class="subst">$&#123;MODEL&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> requestBody = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; </span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">model</span>: <span class="variable constant_">MODEL</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">messages</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">role</span>: <span class="string">&quot;system&quot;</span>, <span class="attr">content</span>: <span class="variable constant_">SYSTEM_PROMPT</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">role</span>: <span class="string">&quot;user&quot;</span>, <span class="attr">content</span>: userMessage &#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">response_format</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&quot;json_schema&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">json_schema</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&quot;math_response&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">schema</span>: <span class="variable constant_">OUTPUT_SCHEMA</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">strict</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] è¯·æ±‚ä½“: <span class="subst">$&#123;requestBody&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] å‘é€APIè¯·æ±‚...`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_URL</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;API_KEY&#125;</span>`</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">body</span>: requestBody</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] æ”¶åˆ°APIå“åº”ï¼ŒçŠ¶æ€ç : <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[ERROR] APIè¯·æ±‚å¤±è´¥: <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`API è¯·æ±‚å¤±è´¥: <span class="subst">$&#123;response.status&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] APIå“åº”æ•°æ®: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> content = data.<span class="property">choices</span>[<span class="number">0</span>].<span class="property">message</span>.<span class="property">content</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DEBUG] æ¨¡å‹è¿”å›å†…å®¹é•¿åº¦: <span class="subst">$&#123;content.length&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(content);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[ERROR] è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">$&#123;error.message&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">throw</span> error;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> message = userInput.<span class="property">value</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (message) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">appendMessage</span>(<span class="string">&#x27;ç”¨æˆ·: &#x27;</span> + message);</span></span><br><span class="line"><span class="language-javascript">                userInput.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title class_">AIService</span>.<span class="title function_">callLargeLanguageModel</span>(message);</span></span><br><span class="line"><span class="language-javascript">                    </span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// æ˜¾ç¤ºè§£é¢˜æ­¥éª¤</span></span></span><br><span class="line"><span class="language-javascript">                    response.<span class="property">steps</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">step, index</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">appendMessage</span>(<span class="string">`æ­¥éª¤ <span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>:`</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">appendMessage</span>(<span class="string">`è§£é‡Š: <span class="subst">$&#123;step.explanation&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">appendMessage</span>(<span class="string">`ç»“æœ: <span class="subst">$&#123;step.output&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                    </span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// æ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆ</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;æœ€ç»ˆç­”æ¡ˆ: &#x27;</span> + response.<span class="property">final_answer</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;é”™è¯¯:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;åŠ©æ‰‹: æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ã€‚&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">appendMessage</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> messageDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            messageDiv.<span class="property">textContent</span> = message;</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="title function_">appendChild</span>(messageDiv);</span></span><br><span class="line"><span class="language-javascript">            chatDiv.<span class="property">scrollTop</span> = chatDiv.<span class="property">scrollHeight</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><p>functionCallè¯·è§<a target="_blank" rel="noopener" href="https://tobenot.top/2024/01/27/Tutorial-LLM-Foundation/">å¤§æ¨¡å‹åŸºç¡€æŠ€æœ¯å­¦ä¹ </a><br>ä¸»è¦æ˜¯æˆ‘ä¸å–œæ¬¢functionCallï¼Œå› ä¸ºç»“æ„åŒ–è¾“å‡ºå¯ä»¥å’Œæ•°æ®äº¤äº’ï¼Œå¤Ÿç”¨äº†ï¼Œè€Œä¸”functionCallåŒå€tokensã€‚</p></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery){var options={selector:".gallery-item"};lightGallery(document.getElementsByClassName(".article-gallery")[0],options)}</script></div><div class="post-meta"><i><span>2024-09-22</span> <span>è¯¥ç¯‡æ–‡ç« è¢« tobenot</span> <span>æ‰“ä¸Šæ ‡ç­¾: <a href="/tags/LLM/">LLM </a><a href="/tags/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯ </a><a href="/tags/GPT/">GPT </a><a href="/tags/JavaScript/">JavaScript </a><a href="/tags/%E5%AE%9E%E8%B7%B5/">å®è·µ </a></span><span>å½’ä¸ºåˆ†ç±»: <a href="/categories/LLM/">LLM</a></span></i></div><br><div class="post-footer-pre-next"><span>ä¸Šä¸€ç¯‡ï¼š<a href="/2024/09/22/Dev-Think-Limits-Of-COT/">COTâ€”â€”æ€ç»´é“¾çš„æé™</a></span> <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2024/07/12/Tutorial-Vercel/">Verceléƒ¨ç½²</a></span></div><div class="comments-container"><div id="comment-anchor"></div><div class="comment-area-title">è¯„è®º</div><div id="waline"></div><script type="module">import{init}from"https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs";function loadWaline(){init({el:"#waline",serverURL:"https://mail.tobenot.top/",lang:"zh-CN",dark:'body[class~="dark-mode"]',requiredMeta:["nick","mail"],search:!1,reaction:!1,pageview:!1,comment:!1,locale:{placeholder:"ä¹Ÿè®¸ä»ä¸€ä¸ªé—®é¢˜å¼€å§‹ï¼Œæ‰æœ‰ç­”æ¡ˆã€‚",sofa:""}})}window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div><div class="footer"><span>Â© 2023-2024 China / <a href="/friends/">å‹é“¾</a></span></div><div class="footer-last"><span>æ˜Ÿç•Œ</span> <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlight.min.js"></script><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlightjs-line-numbers.js"></script><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/randomHeaderContent.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/returnToTop.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript"></script><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/toc.js"></script><script src="/js/lightgallery/lightgallery.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script><script type="text/javascript">if("undefined"!=typeof lightGallery){var options1={selector:".gallery-item",plugins:[lgThumbnail,lgFullscreen,lgAutoplay,lgZoom,lgRotate,lgPager],thumbnail:!0,zoom:!0,rotate:!0,autoplay:!0,fullScreen:!0,pager:!1,zoomFromOrigin:!0,actualSize:!0,enableZoomAfter:300};lightGallery(document.getElementsByClassName(".article-gallery")[0],options1)}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="progress-wrap shadow-drop-2-bottom"><svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102"><path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/></svg></div><div class="return-to-last-progress-wrap shadow-drop-2-bottom"><svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102"><path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/></svg></div></div></body></html>